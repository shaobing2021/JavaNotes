## PUT

### 更新/插入全局

```powershell
###更新索引
PUT http://192.168.11.130:9200/shopping/_doc/1
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{  "title":"小米手机",  "category":"小米",  "images":"http://www.gulixueyuan.com/xm.jpg",  "price":1.00 }
```

> 发送put请求

幂等性，两个id一致？

### 返回

```
{"acknowledged":true,"shards_acknowledged":true,"index":"shopping"}
```

## GET

### 查找所有索引

查找所有索引

GET http://192.168.11.130:9200 /_cat/indices?v

#### 返回

```
<Response body is empty>
health status index uuid pri rep docs.count docs.deleted store.size pri.store.size
yellow open shopping q_AJ7TuaQYW1Ijd-sc1Iyw 1 1 0 0 208b 208b
```

### 查找所有类型

```
{
  "took": 143,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 3,
      "relation": "eq"
    },
    "max_score": 1.0,
    "hits": [
      {
        "_index": "shopping",
        "_type": "_doc",
        "_id": "eAWs33gB-CElxdss-2tR",
        "_score": 1.0,
        "_source": {
          "title": "小米手机",
          "category": "小米",
          "images": "http://www.gulixueyuan.com/xm.jpg",
          "price": 3999.00
        }
      },
      {
        "_index": "shopping",
        "_type": "_doc",
        "_id": "eQWt33gB-CElxdssCWtT",
        "_score": 1.0,
        "_source": {
          "title": "小米手机",
          "category": "小米",
          "images": "http://www.gulixueyuan.com/xm.jpg",
          "price": 3999.00
        }
      },
      {
        "_index": "shopping",
        "_type": "_doc",
        "_id": "1",
        "_score": 1.0,
        "_source": {
          "title": "小米手机",
          "category": "小米",
          "images": "http://www.gulixueyuan.com/xm.jpg",
          "price": 3999.00
        }
      }
    ]
  }
}
```





### 指定查询

```http
###指定查询
GET http://192.168.11.130:9200/shopping/_search?q=title:华为
Cache-Control: no-cache
Accept: */*

###高级查询通过get
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match": {"category": "中米"}}}
###指定查询所有
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match_all": {}}}
```

### 分页查询排序指定查询key

```
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match_all": {}},"from": 2,"size": 2, "_source":["title"],"sort": {"price": {"order": "desc"}}}
```

### 与或查询

```
###同时满足条件
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query":{"bool":{"must":[{"match": {"category": "小米"}},{"match": {"price": "1"}}]}}}

###两者满足其一
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query":{"bool":{"should":[{"match": {"category": "小米"}},{"match": {"price": "1"}}]}}}
```

### 范围查询

```powershell
###过滤查询
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query":{"bool":{"should":[{"match": {"category": "小米"}}],"filter": {"range": {"price":{"gt": 3000} }}}}}
```

### 完全匹配查询

```
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match_phrase": {"category": "中米"}}}
```

### 高亮查询

```
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match_phrase": {"category": "中米"}},"highlight": {"fields": {"category":{}}}}
```

### 聚合查询

```
###聚合操作  price_group随意起名,terms分组,field分组字段,size只对统计结果输出，输出价格一样的为一组，size:0对其他数据不显示
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"aggs": {"price_group": {"terms": {"field": "price"}}},"size": 0}
```

### 平均值查询

```
###avg平均值
GET http://192.168.11.130:9200/shopping/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"aggs": {"price_avg": {"avg": {"field": "price"}}},"size
": 0}

```

### 映射关系

> 索引分三种：分词索引，完全索引，不被索引

```powershell

###映射关系 1 先创建user
PUT http://192.168.11.130:9200/user
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

###2  index:true表示可以索引查询，type:text表示可以被分词查询
PUT http://192.168.11.130:9200/user/_mapping
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"properties": {"name": {"type": "text","index": "true"},"sex":{"type": "keyword","index": true},"tel": {"type": "keyword","index": false}}}

<> 2021-04-18T033402.200.json
###3 查看put的mapping
GET http://192.168.11.130:9200/user/_mapping
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

<> 2021-04-18T033425.200.json
###4 放入数据
POST http://192.168.11.130:9200/user/_doc/3
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{  "name":"oppo手机",  "sex":"女的",  "tel": "136" }

<> 2021-04-18T034706.200.json
<> 2021-04-18T034651.409.json
<> 2021-04-18T034625.409.json


###5 查询   有分词效果，通过小查到小米
GET http://192.168.11.130:9200/user/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match": {"name": "小"}}}

###6查询 通过女查不到女的，必须完全匹配
GET http://192.168.11.130:9200/user/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match": {"sex": "女的"}}}

###7查询 通过电话查询，不能查询，因为电话没被索引，
GET http://192.168.11.130:9200/user/_search
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"query": {"match": {"tel": "136"}}}
```



## DELETE	

DELETE请求  http://192.168.11.130:9200

### 返回

```
{"acknowledged":true}
```

## POST

### 插入

#### 插入一条

请求路径 /shopping/_doc/      这种随机生成id方法不能改为put，否则会报错

/shopping/__doc/1

![image-20210417195002759](image-20210417195002759.png)

```
请求体
{
 "title":"小米手机",
 "category":"小米",
 "images":"http://www.gulixueyuan.com/xm.jpg",
 "price":3999.00
}
```

#### 返回

> id随机生成

```
{
  "_index": "shopping",
  "_type": "_doc",
  "_id": "eQWt33gB-CElxdssCWtT",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 1,
  "_primary_term": 1
}
```

> id固定

```
{
  "_index": "shopping",
  "_type": "_doc",
  "_id": "1",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 2,
  "_primary_term": 1
}
```

### 更新

```
由于更新局部，每次结果不一致，不能用put。更新全局可以用put
```

```
###更新部分
POST http://192.168.11.130:9200/shopping/_update/1
Cache-Control: no-cache
Accept: */*
Content-Type: application/json

{"doc":{  "title":"华为手机" }}
```

#### 返回

```
POST http://192.168.11.130:9200/shopping/_update/1

HTTP/1.1 200 OK
content-type: application/json; charset=UTF-8

{
  "_index": "shopping",
  "_type": "_doc",
  "_id": "1",
  "_version": 7,
  "result": "updated",
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 8,
  "_primary_term": 1
}

Response code: 200 (OK); Time: 130ms; Content length: 156 bytes

```

## DELETE

```
DELETE http://192.168.11.130:9200/shopping/_doc/1
Cache-Control: no-cache
Accept: */*
Content-Type: application/json
```

#### 返回

```
DELETE http://192.168.11.130:9200/shopping/_doc/1

HTTP/1.1 200 OK
content-type: application/json; charset=UTF-8

{
  "_index": "shopping",
  "_type": "_doc",
  "_id": "1",
  "_version": 9,
  "result": "deleted",   //not found
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 10,
  "_primary_term": 1
}

Response code: 200 (OK); Time: 181ms; Content length: 157 bytes

```