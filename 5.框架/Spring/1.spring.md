### 配置文件

#### mybatis整合spring

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.roosevelt</groupId>
    <artifactId>spring-study</artifactId>
    <packaging>pom</packaging>
    <version>1.0-SNAPSHOT</version>
    <dependencies>
<!--        webmvc包括aop，beans，context，core，expression，web包-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
        </dependency>
        <!--如果需要使用aop，则要导入该aop织入包-->
        <dependency>
            <groupId>org.aspectj</groupId>
            <artifactId>aspectjweaver</artifactId>
            <version>1.8.13</version>
        </dependency>
<!--spring 操作数据库需要spring-jdbc，也可以只导入spring-tx包，因为jdbc和mvc包有一些重合了-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>5.0.2.RELEASE</version>
        </dependency>
<!--        mybatis整合spring包-->
        <!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring -->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis-spring</artifactId>
            <version>2.0.4</version>
        </dependency>
			 <!--Mysql驱动-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.6</version>
        </dependency>
        <!--Mybatis-->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.4.5</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.8</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>
     <build>
        <resources>
            <resource>
                <directory>src/main/java</directory>
                <excludes>
                    <exclude>**/*.java</exclude>
                </excludes>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
                <includes>
                    <include>**/*.*</include>
                </includes>
            </resource>
        </resources></build>
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
    </properties>
</project>
```

#### pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.roosevelt</groupId>
    <artifactId>spring-study</artifactId>
    <packaging>pom</packaging>
    <version>1.0-SNAPSHOT</version>
    <modules>
        <module>spring01</module>
        <module>spring2</module>
        <module>spring03</module>
        <module>spring04</module>
    </modules>
    <dependencies>
<!--        webmvc包括aop，beans，context，core，expression，web包-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
        </dependency>
      <!--如果需要使用aop，则要导入该包-->
        <dependency>
            <groupId>org.aspectj</groupId>
            <artifactId>aspectjweaver</artifactId>
            <version>1.8.13</version>
        </dependency>
</dependencies>
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
    </properties>
</project>
```

#### applicationContext.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
<!--  导入spring关联mybatis的配置-->
    <import resource="spring-dao.xml"/>
<!--    <import resource="spring-mvc.xml"/>   -->

    <bean id="userMapper" class="com.roosevelt.dao.UserMapperImpl">
        <property name="sqlSessionFactory" ref="sqlSessionFactory"/>
    </bean>
</beans>
```

#### mybatis-config

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!--此处也可以引入外部文件，但是如果和上面字段相同，则优先使用外部配置文件-->
    <!--配置日志-->
    <settings>
        <setting name="logImpl" value="STDOUT_LOGGING"/>
        <!--开启驼峰命名配置-->
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <!--显式开启全局缓存-->
        <setting name="cacheEnabled" value="true"/>
    </settings>

    <!--可以给实体类起别名-->
    <typeAliases>
        <!--        <typeAlias type="com.roosevelt.pojo.User" alias="User"/>-->
        <!--扫描实体类，默认别名为类名首字母小写，会使用 Bean 的首字母小写的非限定类名来作为它的别名-->
        <package name="com.roosevelt.pojo"/>
    </typeAliases>


<!--    <mappers>-->
    <!--每一个Mapper.xml都需要在Mybatis核心文件中注册,如果是注解需要绑定接口-->

        <!--        推荐使用配置文件-->
        <!--        <mapper resource="com/roosevelt/dao/UserMapper.xml"/>-->
        <!--        如果有很多xml需要配置可以-->
        <!--        <mapper resource="com/roosevelt/dao/TeacherMapper.xml"/>-->
        <!--        <mapper resource="com/roosevelt/mapper/BlogMapper.xml"/>-->
        <!--利用注解配置就用这种方式-->
        <!--        <mapper class="com.roosevelt.dao.UserMapper"/>-->
<!--        <package name="com.roosevelt.dao"/>-->
<!--    </mappers>-->

</configuration>
```

#### spring.xml

##### 使用xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:c="http://www.springframework.org/schema/c"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">
</beans>
```

##### 使用注解

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">
<!--   指定要扫描的包，这个包下的注解会生效-->
    <context:component-scan base-package="com.roosevelt"/>
    <!--开启注解支持-->
    <context:annotation-config/>

</beans>
```

##### 使用aop

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
    <!--   指定要扫描的包，这个包下的注解会生效-->
    <context:component-scan base-package="com.roosevelt"/>
    <!--开启注解支持-->
    <context:annotation-config/>
<!--    方式一：使用原生spring api接口-->
<!--    配置aop，需要导入aop约束-->
    <aop:config>
<!--        切入点-->
        <aop:pointcut id="pointcut" expression="execution(* com.roosevelt.service.UserServiceImpl.*(..))"/>
<!--    执行环绕-->
        <aop:advisor advice-ref="log" pointcut-ref="pointcut" />
        <aop:advisor advice-ref="afterLog" pointcut-ref="pointcut" />
    </aop:config>
<!--    <aop:aspectj-autoproxy  proxy-target-class="true"/>-->
</beans>
```

#### spring-dao.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd">
<!--   DataSource:使用spring的数据源替换Mybatis的配置，c390，dbcp，druid,此处使用jdbc的数据源-->
<bean id = "dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://localhost:3306/shop?userSSl=true&amp;useUnicode=true&amp;characterEncoding=UTF-8"/>
    <property name="username" value="root"/>
    <property name="password" value="root"/>
</bean>
<!--    配置sqlsessionFactory-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
<!--       绑定数据源-->
        <property name="dataSource" ref="dataSource" />
<!--        绑定mabatis配置文件-->
        <property name="configLocation" value="classpath:mybatis-config.xml"/>
<!--      绑定配置-->
        <property name="mapperLocations" value="classpath:com/roosevelt/dao/UserMapper.xml"/>
    </bean>
<!--    sqlsessionTemplate就是sqlsession-->
    <bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate">
<!--        只能使用构造器注入sqlsession，因为它没有set方法-->
        <constructor-arg index="0" ref="sqlSessionFactory"/>
    </bean>
<!--开启声明式事务-->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
<!--        通过构造器注入-->
        <constructor-arg ref="dataSource" />
    </bean>
<!--    结合aop实现事务织入-->
<!--    配置事务通知-->
    <tx:advice id="txAdvice" transaction-manager="transactionManager">
<!--        给哪些方法配置事务-->
<!--        配置事务的传播特性 propagation七种事务 默认required
-->
        <tx:attributes>
            <tx:method name="add" propagation="REQUIRED"/>
            <tx:method name="delete"/>
            <tx:method name="update"/>
            <tx:method name="query" read-only="true"/>
            <tx:method name="*"/>
        </tx:attributes>
    </tx:advice>
<!--    配置aop-->
    <aop:config>
        <aop:pointcut id="pointcut" expression="execution(* com.roosevelt.dao.*.*(..))"/>
        <aop:advisor advice-ref="txAdvice" pointcut-ref="pointcut"/>
    </aop:config>
</beans>
```

[spring文档](file:///F:/java/SSM/spring/spring_day01/%E8%B5%84%E6%96%99/spring-framework-5.0.2.RELEASE-dist/spring-framework-5.0.2.RELEASE/docs/spring-framework-reference/index.html)

[学习文档](https://mp.weixin.qq.com/mp/homepage?__biz=Mzg2NTAzMTExNg==&hid=3&sn=456dc4d66f0726730757e319ffdaa23e&scene=18&devicetype=android-28&version=27000e39&lang=zh_CN&nettype=ctnet&ascene=7&session_us=gh_1dd456f1d44d&pass_ticket=BK3eQY8Jy1yedSZFLAsyiyirXaJs30Z%2FgAOHf2SOODPj9d0mUD6317Eh5mV6301j&wx_header=1)

### 1.简介

[mybatis-spring](http://mybatis.org/spring/zh/index.html)

[官网](https://spring.io/projects/spring-framework#overview)

[spring-jdbc](https://mvnrepository.com/artifact/org.springframework/spring-jdbc)

[spring-webmvc](https://mvnrepository.com/artifact/org.springframework/spring-webmvc)

> Spring是一个轻量级的控制反转（IOC）和面向切面编程(AOP)的框架

```xml
<dependencies>
  <!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc -->
  
  <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-webmvc</artifactId>
      <version>5.0.2.RELEASE</version>
  </dependency>
 <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
  
  
  
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-tx</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>5.1.6</version>
    </dependency>
    <dependency>
        <groupId>org.aspectj</groupId>
        <artifactId>aspectjweaver</artifactId>
        <version>1.8.7</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
</dependencies>
```

### 2.IOC理论推导

> 根据用户需求修改源代码，修改成本高，利用set注入

#### Dao层

```java
package com.roosevelt.dao;

public interface UserDao {
    void getUser();
}
```

```java
package com.roosevelt.dao;

public class UserDaoImpl implements UserDao{
    public void getUser() {
        System.out.println("获取用户数据");
    }
}
```

```java
package com.roosevelt.dao;

public class UserDaoMysqlImpl implements UserDao {
    @Override
    public void getUser() {
        System.out.println("Mysql获取数据");
    }
}
```

#### Service层

```java
package com.roosevelt.service;

public interface UserService {
    void getUser();
}
```

```java
package com.roosevelt.service;

import com.roosevelt.dao.UserDao;
import com.roosevelt.dao.UserDaoImpl;

public class UserServiceImpl implements UserService {
    UserDao userDao ;

    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    public void getUser() {
        userDao.getUser();
    }
}
```

#### 测试

```java
import com.roosevelt.dao.UserDaoImpl;
import com.roosevelt.dao.UserDaoMysqlImpl;
import com.roosevelt.service.UserServiceImpl;
import org.junit.Test;

public class MyTest {
//    public static void main(String[] args) {
//        UserServiceImpl userService = new UserServiceImpl();
//        userService.getUser();
//    }
    @Test
    public void test(){
        UserServiceImpl userService = new UserServiceImpl();
        userService.setUserDao(new UserDaoMysqlImpl());
        userService.getUser();
    }
}
```

#### 结论

* 利用set注入，程序不再具有主动性，而是被动接受对象！
* 降低耦合性，主动权交给用户

#### IOC本质

* DI是实现IOC的一种方法
* 控制反转是通过描述（XML或注解）并通过第三方去生产或获取特定对象的方式。在Spring中实现控制反转的是Ioc容器，其实现方法是依赖注入。

### 3.程序
 
#### 编写实体类

注意类的左边有标志则说明被spring托管了

```java
package com.roosevelt.pojo;
public class Hello {
    private String name;
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public void show(){
        System.out.println("Hello,"+ name );
    }
    @Override
    public String toString() {
        return "Hello{" +
                "name='" + name + '\'' +
                '}';
    }
}
```

#### 配置文件

bean.xml

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">


    <!--bean就是java对象 , 由Spring创建和管理
    Hello beanId = new Hello()
    class名 id名 = new class名()
    property赋值
    id名.setname名 = value值
    核心利用set进行注入
    -->
    <bean id="hello" class="com.roosevelt.pojo.Hello">
    //如果是value则是基本数据类型，如果是对象，则用ref
        <property name="name" value="Spring"/>
    </bean>

</beans>
```

#### 测试

```java
import com.roosevelt.pojo.Hello;
import org.junit.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class MyTest {
    @Test
    public void test(){
        //获取spring上下文对象，拿到spring容器,CPX，一旦加载文件就被初始化了
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        Hello hello = (Hello) context.getBean("hello");
        System.out.println(hello.toString());
    }
}
```

#### 结论

* 使用无参构造创建对象，默认！

* 使用有参创建对象

  * 下标赋值

  ```xml
  <bean id="hello" class="com.roosevelt.pojo.Hello">
      <!-- 1.有参创建对象  下标赋值   -->
      <constructor-arg index="0" value="Java"/>
  </bean>
  ```

  * 类型

  ```xml
  <bean id="hello" class="com.roosevelt.pojo.Hello">
      <!-- 2.通过类型创建对象  类型匹配   不推荐使用    -->
      <constructor-arg type="java.lang.String" value="Java"/>
  </bean>
  ```

  * 参数名

  ```xml
  <bean id="hello" class="com.roosevelt.pojo.Hello">
      <!-- 3.通过参数名创建对象  使用    -->
      <constructor-arg name="name" value="Java"/>
  </bean>
  ```

* 加载配置文件的时候，容器就已经初始化对象了，内存中只有一份实例

### 4.Spring配置

#### 别名

```java
<bean id="hello" class="com.roosevelt.pojo.Hello">
    <!-- 3.通过参数名创建对象  使用    -->
    <constructor-arg name="name" value="Java"/>
</bean>
  <!--起别名-->
<alias name="hello" alias="no"/>

public class MyTest {
    @Test
    public void test(){
        //获取spring上下文对象
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        Hello hello = (Hello) context.getBean("no");
        System.out.println(hello.toString());
    }
}

```

#### Bean的配置

```
<!--id:bean的唯一标识符，相当于对象名
    class:bean对象全限定名
     name：也是别名，而且name可以同时取多个别名，更高级,用，；空格分隔
     scope：单例多例-->
<bean id="hello" class="com.roosevelt.pojo.Hello" name="yes,user1">
    <constructor-arg name="name" value="Java"/>
</bean>
```

#### import

> 一般用于团队开发，假设项目有多个人开发，使用的时候用总的配置即可

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">
<import resource="beans.xml"/>
</beans>
```

### 5.依赖注入

#### 构造器注入

查看4即可

* 依赖：bean对象的创建依赖容器
* 注入：bean对象所有属性由容器注入

#### set方式注入

```java
package com.roosevelt.pojo;

import java.util.*;

public class Student {
    private String name;
    private Address address;
    private String[] books;
    private List<String> hobbys;
    private Map<String,String> card;
    private Set<String> games;
    private String wife;
    private Properties props;

    @Override
    public String toString() {
        return "Student{" +
                "name='" + name + '\'' +
                ", address=" + address +
                ", books=" + Arrays.toString(books) +
                ", hobbys=" + hobbys +
                ", card=" + card +
                ", games=" + games +
                ", wife='" + wife + '\'' +
                ", props=" + props +
                '}';
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Address getAddress() {
        return address;
    }

    public void setAddress(Address address) {
        this.address = address;
    }

    public String[] getBooks() {
        return books;
    }

    public void setBooks(String[] books) {
        this.books = books;
    }

    public List<String> getHobbys() {
        return hobbys;
    }

    public void setHobbys(List<String> hobbys) {
        this.hobbys = hobbys;
    }

    public Map<String, String> getCard() {
        return card;
    }

    public void setCard(Map<String, String> card) {
        this.card = card;
    }

    public Set<String> getGames() {
        return games;
    }

    public void setGames(Set<String> games) {
        this.games = games;
    }

    public String getWife() {
        return wife;
    }

    public void setWife(String wife) {
        this.wife = wife;
    }

    public Properties getProps() {
        return props;
    }

    public void setProps(Properties props) {
        this.props = props;
    }
}
```

```java
package com.roosevelt.pojo;

public class Address {
    private String address;

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }
}
```

##### 注入

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="student" class="com.roosevelt.pojo.Student">
        <!--1.基本类型普通值注入-->
        <property name="name" value="xx"/>
        <!--2.bean注入-->
        <property name="address" ref="address"/>
<!--        3.数组注入-->
        <property name="books">
            <array>
                <value>红楼梦</value>
                <value>水湖庄</value>
            </array>
        </property>
<!--        list-->
        <property name="hobbys">
            <list>
                <value>听歌</value>
                <value>敲代码</value>
            </list>
        </property>
<!--        map-->
        <property name="card">
            <map>
                <entry key="身份证" value="123456"/>
                <entry key="银行卡" value="4304221"/>
            </map>
        </property>
<!--        set-->
        <property name="games">
            <set>
                <value>LOl</value>
                <value>Coc</value>
            </set>
        </property>
<!--        null-->
        <property name="wife">
            <null/>
        </property>
<!--        properties-->
        <property name="props">
            <props>
                <prop key="driver">com.roosevelt</prop>
                <prop key="url">localhost</prop>
                <prop key="username">root</prop>
                <prop key="password">root</prop>
            </props>
        </property>
    </bean>
    <bean id = "address" class="com.roosevelt.pojo.Address"/>
</beans>
```



##### p命名空间

> 配合set方式注入

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="user" class="com.roosevelt.pojo.User" p:name="java" p:age="12"/>

    <bean id = "address" class="com.roosevelt.pojo.Address"/>
</beans>
```

##### c命名空间

> 必须配合构造器使用

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:c="http://www.springframework.org/schema/c"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="user" class="com.roosevelt.pojo.User" p:name="java" p:age="12"/>
    <bean id = "user1" class="com.roosevelt.pojo.User" c:age="15" c:name="python"/>
    <bean id = "address" class="com.roosevelt.pojo.Address"/>
</beans>
```

```java
package com.roosevelt.pojo;

public class User {
    private int age;
    private String name;

    public User() {
    }

    public User(int age, String name) {
        this.age = age;
        this.name = name;
    }

    @Override
    public String toString() {
        return "User{" +
                "age=" + age +
                ", name='" + name + '\'' +
                '}';
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

#### scope

* 单例对象scope="singleton"

> 一个应用只有一个对象的实例。它的作用范围就是整个引用。 生命周期：
> 对象出生：当应用加载，创建容器时，对象就被创建了。 对象活着：只要容器在，对象一直活着。 对象死亡：当应用卸载，销毁容器时，对象就被销毁了。

* 多例对象：scope="prototype"

> 每次访问对象时，都会重新创建对象实例。
>
> 生命周期：
> 对象出生：当使用对象时，创建新的对象实例。 对象活着：只要对象在使用中，就一直活着。 对象死亡：当对象长时间不用时，被 java 的垃圾回收器回收了

* 其余的request，session，application只能在web开发中遇见

### 6.自动装配

> Spring在上下文中会自动寻找，给bean装配属性

* xml中显示配置
* java中显示配置
* **隐式自动装配**

#### Byname自动装配

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:c="http://www.springframework.org/schema/c"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="cat" class="com.roosevelt.pojo.Cat"/>
    <bean id="dog" class="com.roosevelt.pojo.Dog"/>
<!--    byName会自动在容器上下文中查找，和自己对象set方法后面的值对应的beanId-->
    <bean id="people" class="com.roosevelt.pojo.People" autowire="byName">
        <property name="cat" ref="cat"/>
    </bean>

</beans>
```

#### ByType自动装配

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:c="http://www.springframework.org/schema/c"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="cat" class="com.roosevelt.pojo.Cat"/>
    <bean id="dog" class="com.roosevelt.pojo.Dog"/>
<!--    byName会自动在容器上下文中查找，和自己对象set方法后面的值对应的beanId
        byType会自动在上下文中查找，和自己对象属性类型相同的bean，其dog id可以省略-->
    <bean id="people" class="com.roosevelt.pojo.People" autowire="byType">
        <property name="cat" ref="cat"/>
    </bean>

</beans>
```

#### 结论

* ByName beanId唯一，需要和属性set方法值一致
* ByType 需要保证bean的Class唯一，需要和自动注入的属性类型一致

#### 注解自动装配

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">
<!--开启注解支持-->
    <context:annotation-config/>
</beans>
```

##### 注意点

* 可以忽略set方法，也可以在set方法上使用

* ```
  @Autowired(required = false)说明这个字段可以为null
  ```

* 起别名

```
@Qualifier(value = "gou")
```

```
<bean id="gou" class="com.roosevelt.pojo.Dog"/>
```

* `@Resource`相当于@Autowired+@Qualifier，如果名字不匹配，则从类型上面找

```
@Resouce(name= "gou")先找gou
private Dog dog;


<bean id="gou" class="com.roosevelt.pojo.Dog"/>
```



#### 区别

autowired和resouce区别：

* 都是用来自动装配，都可以放在属性字段上
* @Autowired通过bytype实现
* @Resouce默认通过Byname方法实现，如果找不到名字则通过byType实现
* 执行顺序

如果autowired中类不唯一，则使用@qualify起别名进行匹配

### 7.使用注解开发

1. 导入aop包，在mvc包中
2. 注解说明：@Autowired  @Nullable

* Autowired  ：自动装配通过类型，名字
* Nullable：标记了这个注解，说明字段可以为null
* Resource：自动装配通过名字，类型

* component：组件，放在类上，说明该类被spring管理，就是bean

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">
<!--   指定要扫描的包，这个包下的注解会生效-->
    <context:component-scan base-package="com.roosevelt"/>
    <!--开启注解支持-->
    <context:annotation-config/>

</beans>
```

```java
package com.roosevelt.pojo;

import org.springframework.stereotype.Component;

@Component  //等价于加个bean
public class User {
  	@Value（“hello”）
    private String name ;

    public String getName() {
        return name;
    }
		@Value（“python”）
    public void setName(String name) {
        this.name = name;
    }
}
```

* 注入属性：@Value  如上，也可以在set方法上注入

* @Component衍生注解,功能都一样  只要使用这四个注解，表示会自动扫描到容器中
  * dao @Repository
  * service @Service
  * controller @Controller

* 作用域@Scope   @Scope("singleton")

### 9.AOP

#### 方式一：使用原生spring api接口

导包

```xml
<!--如果需要使用aop，则要导入该包-->
<dependency>
    <groupId>org.aspectj</groupId>
    <artifactId>aspectjweaver</artifactId>
    <version>1.8.13</version>
</dependency>
```

代码

```java
package com.roosevelt.log;

import org.aspectj.lang.annotation.AfterReturning;
import org.springframework.aop.AfterReturningAdvice;
import org.springframework.stereotype.Component;

import java.lang.reflect.Method;

@Component
public class AfterLog implements AfterReturningAdvice {
    @Override
    //returnValue:返回值
    public void afterReturning(Object returnValue, Method method, Object[] args, Object target) throws Throwable {
        System.out.println("执行了:"+method.getName()+"返回结果："+returnValue);
    }
}
```

```java
package com.roosevelt.service;

import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {
    @Override
    public void add() {
        System.out.println("add");
    }

    @Override
    public void update() {
        System.out.println("update");
    }

    @Override
    public void delete() {
        System.out.println("delete");
    }

    @Override
    public void query() {
        System.out.println("query");
    }
}
```

配置

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
    <!--   指定要扫描的包，这个包下的注解会生效-->
    <context:component-scan base-package="com.roosevelt"/>
    <!--开启注解支持-->
    <context:annotation-config/>
<!--    方式一：使用原生spring api接口-->
<!--    配置aop，需要导入aop约束-->
    <aop:config>
<!--        切入点-->
        <aop:pointcut id="pointcut" expression="execution(* com.roosevelt.service.UserServiceImpl.*(..))"/>
<!--    执行环绕-->
        <aop:advisor advice-ref="log" pointcut-ref="pointcut" />
        <aop:advisor advice-ref="afterLog" pointcut-ref="pointcut" />
    </aop:config>
<!--    <aop:aspectj-autoproxy  proxy-target-class="true"/>-->
</beans>
```

测试

* 注意点getbean后面必须是接口，因为代理的是接口，其次为什么是userserviceImpl是因为用的注解，所以是类名首字母小写，同时该处不能用接口，因为相当于new对象，

```java
import com.roosevelt.service.User;
import com.roosevelt.service.UserService;
import com.roosevelt.service.UserServiceImpl;
import org.junit.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class MyTest {
    @Test
    public void test(){
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        UserService userservice = context.getBean("userServiceImpl", UserService.class);
        userservice.add();

    }
}
```

#### 方式二：自定义实现AOP

```java
package com.roosevelt.log;

import org.springframework.stereotype.Component;

@Component(value = "diy")
public class DiyPointCut {
    public void before(){
        System.out.println("执行前：");
    }
    public void after(){
        System.out.println("执行后：");
    }
}
```

```java
<aop:config>
    <aop:aspect ref="diy">
        <aop:pointcut id="pointcut" expression="execution(* com.roosevelt.service.UserServiceImpl.*(..))"/>
        <aop:before method="before" pointcut-ref="pointcut"/>
        <aop:after method="after" pointcut-ref="pointcut"/>
    </aop:aspect>
</aop:config>
```

#### 方式三：使用注解方式实现AOP

1. 开启注解支持aop

```xml
<!--    开启注解支持aop-->
    <aop:aspectj-autoproxy/>
```

2. 配置aop通知  
   1. 首先声明为切面@Aspect
   2. 使用注解标明 @Before
   3. 注意切面表达式

```java
package com.roosevelt.log;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.After;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.springframework.stereotype.Component;

@Aspect
@Component(value = "diy")
public class DiyPointCut {
    @Before("execution(* com.roosevelt.service.UserServiceImpl.*(..))")
    public void before(){
        System.out.println("执行前：");
    }
    @After("execution(* com.roosevelt.service.UserServiceImpl.*(..))")
    public void after(){
        System.out.println("执行后：");
    }

    @Around("execution(* com.roosevelt.service.UserServiceImpl.*(..))")
    public void around(ProceedingJoinPoint jp) throws Throwable {
        System.out.println("环绕前：");
        //执行方法
        Object proceed = jp.proceed();
        System.out.println("环绕后：");
    }
}

```

输出结果为：环绕前、执行前，执行，环绕后，执行后

```
<!--    开启注解支持，默认使用JDK代理false，cglib为true-->
    <aop:aspectj-autoproxy  proxy-target-class="true"/>
```

### 10.整合Mybatis

导入相关包

* junit测试包
* mybatis包
* mysql连接池包
* spring相关包
* aop织入包
* mybatis-spring包
* spring-jdbc操作数据库包

> spring相关包

```xml
    <dependencies>
<!--        webmvc包括aop，beans，context，core，expression，web包-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.0.2.RELEASE</version>
    </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
        </dependency>
        <!--如果需要使用aop，则要导入该aop织入包-->
        <dependency>
            <groupId>org.aspectj</groupId>
            <artifactId>aspectjweaver</artifactId>
            <version>1.8.13</version>
        </dependency>
<!--spring 操作数据库需要spring-jdbc，也可以只导入spring-tx包，因为jdbc和mvc包有一些重合了-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>5.0.2.RELEASE</version>
        </dependency>
<!--        mybatis整合spring包-->
        <!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring -->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis-spring</artifactId>
            <version>2.0.4</version>
        </dependency>
    </dependencies>
```

> mybatis相关包

```xml
<dependencies>
    <!--Mysql驱动-->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>5.1.6</version>
    </dependency>
    <!--Mybatis-->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.4.5</version>
    </dependency>
</dependencies>
```

#### 步骤

* 在spring-dao.xml中注册sqlsessionFactory和数据源，构建sqlsession

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
<!--   DataSource:使用spring的数据源替换Mybatis的配置，c390，dbcp，druid,此处使用jdbc的数据源-->
<bean id = "dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://localhost:3306/shop?userSSl=true&amp;useUnicode=true&amp;characterEncoding=UTF-8"/>
    <property name="username" value="root"/>
    <property name="password" value="root"/>
</bean>
<!--    配置sqlsessionFactory,这里可以配mybatis的几乎一切-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
<!--       绑定数据源-->
        <property name="dataSource" ref="dataSource" />
<!--        绑定mabatis配置文件-->
        <property name="configLocation" value="classpath:mybatis-config.xml"/>
<!--      绑定配置-->
        <property name="mapperLocations" value="classpath:com/roosevelt/dao/UserMapper.xml"/>
    </bean>
<!--    sqlsessionTemplate就是sqlsession-->
    <bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate">
<!--        只能使用构造器注入sqlsession，因为它没有set方法-->
        <constructor-arg index="0" ref="sqlSessionFactory"/>
    </bean>

</beans>
```

* 在spring-dao.xml中绑定mybatis-config.xml
* 在applicationContext.xml中引入spring-dao.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
<!--  导入spring关联mybatis的配置-->
    <import resource="spring-dao.xml"/>
<!--    <import resource="spring-mvc.xml"/>   -->

    <bean id="userMapper" class="com.roosevelt.dao.UserMapperImpl">
        <property name="sqlsession" ref="sqlSession"/>
    </bean>
</beans>
```

* 同时引入实现类，方便获取类对象
* mybatis-config.xml中的一切，其实都可以在spring-dao配置文件中配置

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!--此处也可以引入外部文件，但是如果和上面字段相同，则优先使用外部配置文件-->
    <!--配置日志-->
    <settings>
        <setting name="logImpl" value="STDOUT_LOGGING"/>
        <!--开启驼峰命名配置-->
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <!--显式开启全局缓存-->
        <setting name="cacheEnabled" value="true"/>
    </settings>

    <!--可以给实体类起别名-->
    <typeAliases>
        <!--        <typeAlias type="com.roosevelt.pojo.User" alias="User"/>-->
        <!--扫描实体类，默认别名为类名首字母小写，会使用 Bean 的首字母小写的非限定类名来作为它的别名-->
        <package name="com.roosevelt.pojo"/>
    </typeAliases>


<!--    <mappers>-->
    <!--每一个Mapper.xml都需要在Mybatis核心文件中注册,如果是注解需要绑定接口-->

        <!--        推荐使用配置文件-->
        <!--        <mapper resource="com/roosevelt/dao/UserMapper.xml"/>-->
        <!--        如果有很多xml需要配置可以-->
        <!--        <mapper resource="com/roosevelt/dao/TeacherMapper.xml"/>-->
        <!--        <mapper resource="com/roosevelt/mapper/BlogMapper.xml"/>-->
        <!--利用注解配置就用这种方式-->
        <!--        <mapper class="com.roosevelt.dao.UserMapper"/>-->
<!--        <package name="com.roosevelt.dao"/>-->
<!--    </mappers>-->

</configuration>
```

#### 测试

```java
@Test
public void test1(){
    ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
    UserMapper userMapper = context.getBean("userMapper", UserMapper.class);
    List<User> userList = userMapper.getUserList();
    for (User user : userList) {
        System.out.println(user);
    }
}
```

#### 理解

为什么要这样一步步走下来，可以参考之前的测试代码

> 首先需要从配置文件获取配置信息，这里在spring-dao中配置
>
> 其次获取sqlsession，要创建sqlsessionfactory，创建sqlsesionfactory依赖配置文件
>
> 因此在spring-dao.xml中配置dataSource，sqlsessionfactory，sqlsession

```java
public void test() throws IOException {
    String resource = "mybatis-config.xml";
    InputStream in = Resources.getResourceAsStream(resource);
    SqlSessionFactory sessionFactory = new SqlSessionFactoryBuilder().build(in);
    SqlSession sqlSession = sessionFactory.openSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    List<User> userList = mapper.getUserList();
    for (User user : userList) {

    }
}
```

#### 方式二：

> 其实与1相似，但是不同的是省去了注入sqlsession
>
> 但是仍然需要sqlsessionfactory

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd">
<!--  导入spring关联mybatis的配置-->
    <import resource="spring-dao.xml"/>
<!--    <import resource="spring-mvc.xml"/>   -->

    <bean id="userMapper" class="com.roosevelt.dao.UserMapperImpl">
        <property name="sqlSessionFactory" ref="sqlSessionFactory"/>
    </bean>
</beans>
```

```java
package com.roosevelt.dao;

import com.roosevelt.pojo.User;
import org.apache.ibatis.session.SqlSession;
import org.mybatis.spring.SqlSessionTemplate;
import org.mybatis.spring.support.SqlSessionDaoSupport;
import org.springframework.jdbc.core.JdbcTemplate;

import java.util.List;

public class UserMapperImpl  extends SqlSessionDaoSupport implements UserMapper {

    @Override
    public List<User> getUserList() {
        SqlSession sqlSession = getSqlSession();
        UserMapper mapper = sqlSession.getMapper(UserMapper.class);
        List<User> userList = mapper.getUserList();
        return userList;
    }
}
```

### 11.事务

> 事务：要么都成功，要么都失败
>
> 完整性，一致性

#### 事务

##### ACID

* 持久性：事务一旦提交，无论系统发生什么问题，结果都不会受影响
* 原子性：
* 一致性
* 隔离性

#### 声明式事务

如果不配置事务，那么在执行getUserList方法中，会执行增加成功，而不删除

```java
package com.roosevelt.dao;

import com.roosevelt.pojo.User;
import org.apache.ibatis.session.SqlSession;
import org.mybatis.spring.SqlSessionTemplate;
import org.mybatis.spring.support.SqlSessionDaoSupport;
import org.springframework.jdbc.core.JdbcTemplate;

import java.util.List;

public class UserMapperImpl  extends SqlSessionDaoSupport implements UserMapper {
//    SqlSession sqlSession = getSqlSession();
//    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    @Override
    public List<User> getUserList() {
        UserMapper mapper = getSqlSession().getMapper(UserMapper.class);
        User user = new User(48, "april", "one");
        mapper.addUser(user);
        System.out.println("--------");
        mapper.deleteUser(1);
        List<User> userList = mapper.getUserList();
        return userList;
    }

    @Override
    public int addUser(User user) {
        UserMapper mapper = getSqlSession().getMapper(UserMapper.class);
        return mapper.addUser(user);
    }

    @Override
    public int deleteUser(int id) {
        UserMapper mapper = getSqlSession().getMapper(UserMapper.class);
        return mapper.deleteUser(id);
    }

}
```

配置事务

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd">
<!--   DataSource:使用spring的数据源替换Mybatis的配置，c390，dbcp，druid,此处使用jdbc的数据源-->
<bean id = "dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://localhost:3306/shop?userSSl=true&amp;useUnicode=true&amp;characterEncoding=UTF-8"/>
    <property name="username" value="root"/>
    <property name="password" value="root"/>
</bean>
<!--    配置sqlsessionFactory-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
<!--       绑定数据源-->
        <property name="dataSource" ref="dataSource" />
<!--        绑定mabatis配置文件-->
        <property name="configLocation" value="classpath:mybatis-config.xml"/>
<!--      绑定配置-->
        <property name="mapperLocations" value="classpath:com/roosevelt/dao/UserMapper.xml"/>
    </bean>
<!--    sqlsessionTemplate就是sqlsession-->
    <bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate">
<!--        只能使用构造器注入sqlsession，因为它没有set方法-->
        <constructor-arg index="0" ref="sqlSessionFactory"/>
    </bean>
<!--开启声明式事务-->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
<!--        通过构造器注入-->
        <constructor-arg ref="dataSource" />
    </bean>
<!--    结合aop实现事务织入-->
<!--    配置事务通知-->
    <tx:advice id="txAdvice" transaction-manager="transactionManager">
<!--        给哪些方法配置事务-->
<!--        配置事务的传播特性 propagation七种事务 默认required
-->
        <tx:attributes>
            <tx:method name="add" propagation="REQUIRED"/>
            <tx:method name="delete"/>
            <tx:method name="update"/>
            <tx:method name="query" read-only="true"/>
            <tx:method name="*"/>
        </tx:attributes>
    </tx:advice>
<!--    配置aop-->
    <aop:config>
        <aop:pointcut id="pointcut" expression="execution(* com.roosevelt.dao.*.*(..))"/>
        <aop:advisor advice-ref="txAdvice" pointcut-ref="pointcut"/>
    </aop:config>
</beans>
```

#### 思考

> 为何需要事务，保证ACID原则

### Spring模块

* Spring Core
* AOP
* ORM
* DAO
* WEB
* Context
* MVC