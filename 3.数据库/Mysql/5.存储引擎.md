存储引擎是数据库的核心，对于mysql来说，存储引擎是以插件的形式运行的。虽然mysql支持种类繁多的存储引擎，但是常用的就那么几种。这篇文章主要是对其进行一个总结和对比。

## **一、引言**

在mysql5之后，支持的存储引擎有十几个，但是常用的就那么几种，而且默认支持的也是InnoDB，既然要进行一个对比，我们就要从不同的维度来看一下。

我们可以使用命令来看看当前数据库可以支持的存储引擎有哪些。

![img](https://pics4.baidu.com/feed/54fbb2fb43166d2206136603e7a401f19152d24a.jpeg?token=0d26e12ee6bd0e7e2f1f66cf7cb5a113&s=4D52AB42C3B4B26A54D9050E000030C1)

在这里我们发现默认支持了9种。还是比较多的，下面我们进行一个对比。

不同的存储引擎都有各自的特点，以适应不同的需求，如表所示。为了做出选择，首先要考虑每一个存储引擎提供了哪些不同的功能。

![img](https://pics3.baidu.com/feed/63d9f2d3572c11df6ce63351c1a06ad6f703c21f.jpeg?token=e037dd0733366e733945ff970d1d8d5f&s=88287C321F5A6C4354DD11DA0000C0B2)

在这里我们列举了一些特点并作出了比较。下面我们来具体分析对比一下。

## **二、存储引擎**

### **1、MyISAM**

使用这个存储引擎，每个MyISAM在磁盘上存储成三个文件。**支持表锁，但是不支持行锁**

（1）frm文件：存储表的定义数据

（2）MYD（Mydata）文件：存放表具体记录的数据

（3）MYI（myindex）文件：存储索引

frm和MYI可以存放在不同的目录下。MYI文件用来存储索引，但仅保存记录所在页的指针，索引的结构是B+树结构。下面这张图就是MYI文件保存的机制：

![img](https://pics1.baidu.com/feed/f9198618367adab4d0c6e43a2953bb1a8601e4c7.jpeg?token=589182b3bf01e1fc9952977a8bedd815&s=E07C2072511FE1CC18C4DDCA020060B1)

从这张图可以发现，这个存储引擎通过MYI的B+树结构来查找记录页，再根据记录页查找记录。并且支持全文索引、B树索引和数据压缩。

支持数据的类型也有三种：

（1）静态固定长度表

这种方式的优点在于存储速度非常快，容易发生缓存，而且表发生损坏后也容易修复。缺点是占空间。这也是默认的存储格式。

（2）动态可变长表

优点是节省空间，但是一旦出错恢复起来比较麻烦。

（3）压缩表

上面说到支持数据压缩，说明肯定也支持这个格式。在数据文件发生错误时候，可以使用check table工具来检查，而且还可以使用repair table工具来恢复。

有一个重要的特点那就是**不支持事务**，但是这也意味着他的**存储速度更快**，如果你的读写操作允许有错误数据的话，只是追求速度，可以选择这个存储引擎。

### **2、InnoDB**

InnoDB是默认的数据库存储引擎，他的主要特点有：

（1）可以通过自动增长列，方法是auto_increment。

（2）支持**事务**。默认的事务隔离级别为可重复度，通过MVCC（并发版本控制）来实现的。

（3）使用的锁粒度为**行级锁**，可以支持**更高的并发**；但是没有放弃表锁

（4）**支持外键约束**；外键约束其实降低了表的查询速度，但是增加了表之间的耦合度。**其他表不支持外键**

（5）配合一些热备工具可以支持在线热备份；

（6）在InnoDB中存在着缓冲管理，通过缓冲池，将索引和数据全部缓存起来，加快查询的速度；

（7）对于InnoDB类型的表，其数据的物理组织形式是**聚簇表**。所有的数据按照主键来组织。**数据和索引**放在一块，都位于B+数的叶子节点上；

当然InnoDB的存储表和索引也有下面两种形式：

（1）使用共享表空间存储：所有的表和索引存放在同一个表空间中。

（2）使用多表空间存储：**表结构放在frm文件，数据和索引放在IBD文件**中。分区表的话，每个分区对应单独的IBD文件。使用分区表的好处在于提升查询效率。

对于InnoDB来说，最大的特点在于支持事务。但是这是以损失效率来换取的。

### **3、Memory**

将数据存在内存，为了提高数据的访问速度，每一个表实际上和一个磁盘文件关联。文件是frm。

（1）支持的数据类型有限制，比如：不支持TEXT和BLOB类型，对于字符串类型的数据，只支持固定长度的行，VARCHAR会被自动存储为CHAR类型；

（2）支持的锁粒度为表级锁。所以，在访问量比较大时，表级锁会成为MEMORY存储引擎的瓶颈；

（3）由于**数据是存放在内存中**，一旦服务器出现故障，数据都会丢失；

（4）查询的时候，如果有用到临时表，而且临时表中有BLOB，TEXT类型的字段，那么这个临时表就会转化为MyISAM类型的表，性能会急剧降低；

（5）默认使用hash索引。

（6）如果一个内部表很大，会转化为磁盘表。

在这里只是给出3个常见的存储引擎。使用哪一种引擎需要灵活选择，一个数据库中多个表可以使用不同引擎以满足各种性能和实际需求，使用合适的存储引擎，将会提高整个数据库的性能

# 三、面试题

> 频繁插入的数据用什么存储引擎更合适

* 选择Myisam
* Myisam支持表锁，占用内存少，而Innodb使用行锁，非常耗内存
* Myisam是**非聚集索引**，索引记录与存储分离的，有单独的区域存储行记录
  * 其数据文件紧密存储，中间没有空闲块，数据总是插入到数据文件的尾部，就如同追加日志一样。性能很高，此时并发插入和插入不加锁。

* 就是如果中间删除一些数据，导致出现空闲块这时就会有表锁冲突，无法并发，随着插入的进行，中间空闲块进行填充，会继续并发的插入。
* 注意写锁拥有更高优先级，大量update请求，select会等update请求完毕才执行。